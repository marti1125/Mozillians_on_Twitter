doctype html
html
  head
    meta(charset='utf-8')
    title= title
    link(rel='stylesheet', href='/stylesheets/foundation.min.css')
    link(rel='stylesheet', href='/stylesheets/normalize.css')
    link(rel='stylesheet', href='/stylesheets/style.css')

  body
    block content
    script(src='https://login.persona.org/include.js')
    script(src='javascripts/foundation.min.js')

  script.

    navigator.id.watch({
      onlogin: function(assertion) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/persona/verify", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.addEventListener("loadend", function(e) {
          var data = JSON.parse(this.responseText);
          if (data && data.status === "okay") {
            console.log("You have been logged in as: " + data.email);
          }
        }, false);

        xhr.send(JSON.stringify({
          assertion: assertion
        }));
      },

      onlogout: function() {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/persona/logout", true);
        xhr.addEventListener("loadend", function(e) {
          console.log("You have been logged out");
        });
        xhr.send();
      }
    });

    document.querySelector("#login").addEventListener("click", function() {
      navigator.id.request();
    }, false);

    document.querySelector("#logout").addEventListener("click", function() {
      navigator.id.logout();
    }, false);      	